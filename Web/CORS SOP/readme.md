## üåê Cross-Origin Resource Sharing Overview


Cross-Origin Resource Sharing (CORS) is a mechanism defined by HTTP headers that allows servers to dictate how resources can be requested from different origins. While the Same-Origin Policy (SOP) restricts web pages to same-domain requests by default, CORS enables servers to declare exceptions to this policy, permitting cross-domain resource access under controlled conditions.

CORS operates via specific HTTP headers sent in server responses. These headers define allowed origins, permissible HTTP methods, and credential usage. The server processes the request and attaches CORS headers; the browser then interprets these headers to grant or deny the frontend JavaScript access to the response data.

## üì¶ HTTP Headers Involved

The following HTTP headers form the foundation of CORS policies:

* Access-Control-Allow-Origin: Specifies exact domains permitted to access the resource.
* Access-Control-Allow-Methods: Specifies allowed HTTP methods (GET, POST, PUT, DELETE, etc.).
* Access-Control-Allow-Headers: Indicates permissible HTTP headers during the request.
* Access-Control-Max-Age: Defines the cache duration for preflight request results.
* Access-Control-Allow-Credentials: Instructs the browser to expose the response when credentials (cookies, HTTP authentication, client-side SSL certificates) are included. When enabled, Access-Control-Allow-Origin cannot utilize a wildcard and must specify an explicit domain.

```http
# Example CORS Headers Response
Access-Control-Allow-Origin: [https://example.com](https://example.com)
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Credentials: true
```
* Tool: HTTP Client Response Evaluator

## üõ†Ô∏è Common Application Scenarios

CORS is standard in modern web architecture to facilitate external integrations:

* APIs and Web Services: Enabling frontend client applications to fetch backend data from distinct API domains.
* Content Delivery Networks (CDNs): Securely loading libraries, scripts, or assets across domains.
* Web Fonts: Permitting cross-domain loading of typography from centralized repositories.
* Third-Party Plugins/Widgets: Integrating external functional modules like chatbots or social sharing buttons.
* Multi-Domain User Authentication: Facilitating Single Sign-On (SSO) and token-based authentication (OAuth) protocols across multiple origins.

## üö¶ Request Classifications


CORS requests are categorized into two primary execution flows:

Simple Requests: Processed similarly to standard same-origin requests. A request is simple if it uses GET, HEAD, or POST. For POST requests, the Content-Type must be application/x-www-form-urlencoded, multipart/form-data, or text/plain. No non-CORS-safe custom headers are permitted. The browser sends the request directly with an Origin header, and the response is validated against the Access-Control-Allow-Origin header. Credentials are included if previously set by the site.

Preflight Requests: Executed when a request falls outside simple parameters (e.g., using PUT/DELETE, strict Content-Type variations, or custom headers). The browser automatically sends an initial OPTIONS request to verify server policies via Access-Control-Request-Method and Access-Control-Request-Headers. The server responds with allowed methods and origins. If validation succeeds, the browser dispatches the actual request.

```bash
# Simulating a Preflight OPTIONS Request
curl -X OPTIONS [https://api.example.com/resource](https://api.example.com/resource) \
  -H "Origin: [https://client.example.com](https://client.example.com)" \
  -H "Access-Control-Request-Method: PUT" \
  -v
```
* Tool: cURL Command Line

## ‚öôÔ∏è ACAO Configurations

Access-Control-Allow-Origin (ACAO) settings dictate the strictness of access boundaries:

Single Origin: Only requests originating from the specified exact domain are allowed. Represents the most secure baseline configuration.
```http
# Single Origin Rule
Access-Control-Allow-Origin: [https://example.com](https://example.com)
```
* Tool: Web Server Configuration

Multiple Origins: Dynamically generated by the server based on an internal allowlist of origins. Requires robust backend validation logic to prevent spoofing.

Wildcard Origin: Permits requests from any arbitrary origin. Appropriate exclusively for public data lacking sensitive information.
```http
# Wildcard Origin Rule
Access-Control-Allow-Origin: *
```
* Tool: Web Server Configuration

With Credentials: ACAO must be set to a specific origin (wildcards are strictly forbidden) combined with Access-Control-Allow-Credentials: true. Allows cookie and HTTP authentication transmission for cross-origin interactions.

## ‚ö†Ô∏è CORS Misconfigurations

Improper CORS implementation introduces high-severity security vulnerabilities:

Null Origin Misconfiguration: Accepting requests from the 'null' origin allows exploitation via local HTML files or data URIs. Attackers can execute cross-origin requests by delivering malicious HTML attachments via phishing. Servers must never trust the 'null' origin unconditionally.

Bad Regex in Origin Checking: Flawed regular expressions allow unintended domain matches.
```javascript
# Vulnerable Regex Patterns
const isValidSuffix = /example.com$/.test(origin); // Vulnerability: Matches badexample.com
const isValidPrefix = /^https:\/\/[example.com/.test(origin](https://example.com/.test(origin)); // Vulnerability: Matches [https://example.com.attacker.com](https://example.com.attacker.com)
```
* Tool: Node.js Regex Engine

Trusting Arbitrary Supplied Origin: Servers dynamically echoing the provided Origin header back into the ACAO response header bypass SOP restrictions entirely. Application architectures must utilize a strict, immutable allowlist rather than blindly echoing input.

## ‚àÖ Null Origin Context

The "null" origin is typically encountered in highly restricted or localized contexts:

* Local Files and Development: Local execution via file:/// URLs triggers a "null" origin behavior from the browser.
* Sandboxed Iframes: Iframes utilizing the sandbox attribute without the allow-same-origin directive will execute isolated with a "null" origin.
* Specific Non-Web Clients: Unconventional programmatic clients operating outside standard browser architectures may omit standard origin data. Allowing "null" as a workaround is an anti-pattern and discouraged in production environments.
